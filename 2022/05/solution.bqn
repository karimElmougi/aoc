#! /usr/bin/env BQN

âŸ¨Partition, ToNumâŸ© â† â€¢Import "../../utils.bqn"

input â† â€¢FLines "input.txt"
# input â† âŸ¨
#     "    [D]    "
#     "[N] [C]    "
#     "[Z] [M] [P]"
#     " 1   2   3 "
#     ""
#     "move 1 from 2 to 1"
#     "move 3 from 1 to 3"
#     "move 2 from 2 to 1"
#     "move 1 from 1 to 2"
# âŸ©

âŸ¨stacks, instructionsâŸ© â† (Ã—â‰ Â¨)âŠ¸Partition input
stacks â†© @âˆ¾ ' 'âŠ¸â‰ âŠ¸/Â¨ <Ë˜ Â¯1â†“Ë˜ {1+4Ã—â†•4Ã·Ëœ1+â‰ ğ•©}âŠ¸âŠ (â‰> stacks)
instructions â†© (ToNumÂ¨ (â‰¥âŸœ'0'âˆ§â‰¤âŸœ'9')âŠ¸Partition)Â¨ instructions

_to_stack â† {Fn _ğ•£:
    {ğ•Š stack:
        Push â‡ {stack â†© ğ•©âˆ¾stack }
        Pop â‡ {ğ•¤ â‹„ head â† ğ•©â†‘stack â‹„ stack â†© ğ•©â†“stack â‹„ Fn head} 
        Data â‡ {ğ•¤ â‹„ stack }
    }
}
Push â† {ğ•¨.Push ğ•©}
Pop â† {ğ•¨.Pop ğ•©}
Data â† {ğ•©.Data@}

Apply â† { 
    st â† ğ•©
    ins â† ğ•¨
    { nâ€¿fromâ€¿to â† ğ•© â‹„ (toâŠ¸âŠ‘ Push PopâŸœnâˆ˜(fromâŠ¸âŠ‘)) st }Â¨ ins 
    âŠ‘âˆ˜DataÂ¨ st
}

â€¢Show instructions Apply âŒ½_to_stackÂ¨ stacks
â€¢Show instructions Apply âŠ¢_to_stackÂ¨ stacks
