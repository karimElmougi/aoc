#! /usr/bin/env BQN

âŸ¨Partition, Split, ToNumâŸ© â† â€¢Import "../../utils.bqn"

input â† â€¢FLines "input.txt"
# input â† âŸ¨
#     "$ cd /"
#     "$ ls"
#     "dir a"
#     "14848514 b.txt"
#     "8504156 c.dat"
#     "dir d"
#     "$ cd a"
#     "$ ls"
#     "dir e"
#     "29116 f"
#     "2557 g"
#     "62596 h.lst"
#     "$ cd e"
#     "$ ls"
#     "584 i"
#     "$ cd .."
#     "$ cd .."
#     "$ cd d"
#     "$ ls"
#     "4060174 j"
#     "8033020 d.log"
#     "5626152 d.ext"
#     "7214296 k"
# âŸ©

Parent â† ("/"âŠ¸â‰¡ â—¶  (Â¯1âŠ¸â†“)â€¿âŠ¢) âˆ˜ â€¢file.Parent
JoinPath â† âŠ‘âˆ˜("."â€¿".."âŠ¸âŠâˆ˜â‹ˆ)âˆ˜âŠ¢â—¶âŠ£â€¿(Parentâˆ˜âŠ£)â€¿â€¢file.At
StartsWith â† âˆ¨Â´âˆ˜â·Ëœ

cd_mask â† StartsWithâŸœ"$ cd"Â¨ input
ls_mask â† StartsWithâŸœ"$ ls"Â¨ input

ls_results â† (Â¬âˆ˜StartsWithâŸœ"dir"Â¨)âŠ¸/Â¨ (Â¬ ls_mask âˆ¨ cd_mask) Partition input

sizes â† ToNumâˆ˜(0âŠ¸âŠ‘)âˆ˜(' 'âŠ¸Split)Â¨ âˆ¾Â´ ls_results
names â† 1âŠ¸âŠ‘âˆ˜(' 'âŠ¸Split)Â¨ âˆ¾Â´ ls_results

directories â† â· (JoinPath` 5â†“Â¨ cd_mask / input)
files â† names â€¢file.AtËœÂ¨ (/â‰ Â¨ ls_results) âŠ directories

DirSize â† { +Â´ /âŸœsizes (StartsWithâŸœğ•©)Â¨ files}
dir_sizes â† DirSizeÂ¨ directories

â€¢Show +Â´ (â‰¤âŸœ100000)âŠ¸/ dir_sizes

free_space â† 70000000 - âŠ‘dir_sizes
to_free â† 30000000 - free_space
â€¢Show âŠ‘ to_freeâŠ¸â‰¤âŠ¸/ âˆ§dir_sizes
